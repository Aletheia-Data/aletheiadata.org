"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _react = _interopRequireWildcard(require("react"));

var _searchUi = require("@elastic/search-ui");

var _SearchContext = _interopRequireDefault(require("./SearchContext"));

var _A11yNotifications = _interopRequireDefault(require("./A11yNotifications"));

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

function _createSuper(Derived) { return function () { var Super = (0, _getPrototypeOf2.default)(Derived), result; if (_isNativeReflectConstruct()) { var NewTarget = (0, _getPrototypeOf2.default)(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return (0, _possibleConstructorReturn2.default)(this, result); }; }

function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }

/**
 * The SearchProvider primarily holds a reference to the SearchDriver and
 * exposes it to the rest of the application in a Context.
 */
var SearchProvider = /*#__PURE__*/function (_Component) {
  (0, _inherits2.default)(SearchProvider, _Component);

  var _super = _createSuper(SearchProvider);

  function SearchProvider() {
    var _this;

    (0, _classCallCheck2.default)(this, SearchProvider);
    _this = _super.call(this);
    _this.state = {
      driver: null
    };
    return _this;
  }

  (0, _createClass2.default)(SearchProvider, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      var config = this.props.config; // This initialization is done inside of componentDidMount, because initializing the SearchDriver server side
      // will error out, since the driver depends on window. Placing the initialization inside of componentDidMount
      // assures that it won't attempt to initialize server side.

      var driver = new _searchUi.SearchDriver(_objectSpread({}, config, {
        a11yNotificationMessages: _objectSpread({}, _A11yNotifications.default, {}, config.a11yNotificationMessages)
      }));
      this.setState({
        driver: driver
      });
    }
  }, {
    key: "componentWillUnmount",
    value: function componentWillUnmount() {
      this.state.driver.tearDown();
    }
  }, {
    key: "render",
    value: function render() {
      var children = this.props.children; // Since driver is initialized in componentDidMount above, we are waiting
      // to render until the driver is available.

      if (!this.state.driver) return null; // Passing the entire "this.state" to the Context is significant. Because
      // Context determines when to re-render based on referential identity
      // something like this could cause unnecessary renders:
      //
      // <SearchContext.Provider value={{driver: this.state.driver}}>
      //
      // By passing the entire state, we ensure that re-renders only occur when
      // state is actually updated.

      return /*#__PURE__*/_react.default.createElement(_SearchContext.default.Provider, {
        value: this.state
      }, children);
    }
  }]);
  return SearchProvider;
}(_react.Component);

(0, _defineProperty2.default)(SearchProvider, "propTypes", {
  children: _propTypes.default.node.isRequired,
  // Not providing a shape here because the shape matches the shape of
  // SearchDriver. SearchDriver can do it's own parameter validation.
  config: _propTypes.default.object
});
var _default = SearchProvider;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9TZWFyY2hQcm92aWRlci5qcyJdLCJuYW1lcyI6WyJTZWFyY2hQcm92aWRlciIsInN0YXRlIiwiZHJpdmVyIiwiY29uZmlnIiwicHJvcHMiLCJTZWFyY2hEcml2ZXIiLCJhMTF5Tm90aWZpY2F0aW9uTWVzc2FnZXMiLCJkZWZhdWx0QTExeU1lc3NhZ2VzIiwic2V0U3RhdGUiLCJ0ZWFyRG93biIsImNoaWxkcmVuIiwiQ29tcG9uZW50IiwiUHJvcFR5cGVzIiwibm9kZSIsImlzUmVxdWlyZWQiLCJvYmplY3QiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBRUE7O0FBQ0E7O0FBRUE7Ozs7Ozs7Ozs7QUFFQTs7OztJQUlNQSxjOzs7OztBQVFKLDRCQUFjO0FBQUE7O0FBQUE7QUFDWjtBQUNBLFVBQUtDLEtBQUwsR0FBYTtBQUNYQyxNQUFBQSxNQUFNLEVBQUU7QUFERyxLQUFiO0FBRlk7QUFLYjs7Ozt3Q0FFbUI7QUFBQSxVQUNWQyxNQURVLEdBQ0MsS0FBS0MsS0FETixDQUNWRCxNQURVLEVBRWxCO0FBQ0E7QUFDQTs7QUFDQSxVQUFNRCxNQUFNLEdBQUcsSUFBSUcsc0JBQUosbUJBQ1ZGLE1BRFU7QUFFYkcsUUFBQUEsd0JBQXdCLG9CQUNuQkMsMEJBRG1CLE1BRW5CSixNQUFNLENBQUNHLHdCQUZZO0FBRlgsU0FBZjtBQU9BLFdBQUtFLFFBQUwsQ0FBYztBQUNaTixRQUFBQSxNQUFNLEVBQU5BO0FBRFksT0FBZDtBQUdEOzs7MkNBRXNCO0FBQ3JCLFdBQUtELEtBQUwsQ0FBV0MsTUFBWCxDQUFrQk8sUUFBbEI7QUFDRDs7OzZCQUVRO0FBQUEsVUFDQ0MsUUFERCxHQUNjLEtBQUtOLEtBRG5CLENBQ0NNLFFBREQsRUFHUDtBQUNBOztBQUNBLFVBQUksQ0FBQyxLQUFLVCxLQUFMLENBQVdDLE1BQWhCLEVBQXdCLE9BQU8sSUFBUCxDQUxqQixDQU9QO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBQ0EsMEJBQ0UsNkJBQUMsc0JBQUQsQ0FBZSxRQUFmO0FBQXdCLFFBQUEsS0FBSyxFQUFFLEtBQUtEO0FBQXBDLFNBQ0dTLFFBREgsQ0FERjtBQUtEOzs7RUF4RDBCQyxnQjs7OEJBQXZCWCxjLGVBQ2U7QUFDakJVLEVBQUFBLFFBQVEsRUFBRUUsbUJBQVVDLElBQVYsQ0FBZUMsVUFEUjtBQUVqQjtBQUNBO0FBQ0FYLEVBQUFBLE1BQU0sRUFBRVMsbUJBQVVHO0FBSkQsQztlQTBETmYsYyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBQcm9wVHlwZXMgZnJvbSBcInByb3AtdHlwZXNcIjtcbmltcG9ydCBSZWFjdCwgeyBDb21wb25lbnQgfSBmcm9tIFwicmVhY3RcIjtcblxuaW1wb3J0IHsgU2VhcmNoRHJpdmVyIH0gZnJvbSBcIkBlbGFzdGljL3NlYXJjaC11aVwiO1xuaW1wb3J0IFNlYXJjaENvbnRleHQgZnJvbSBcIi4vU2VhcmNoQ29udGV4dFwiO1xuXG5pbXBvcnQgZGVmYXVsdEExMXlNZXNzYWdlcyBmcm9tIFwiLi9BMTF5Tm90aWZpY2F0aW9uc1wiO1xuXG4vKipcbiAqIFRoZSBTZWFyY2hQcm92aWRlciBwcmltYXJpbHkgaG9sZHMgYSByZWZlcmVuY2UgdG8gdGhlIFNlYXJjaERyaXZlciBhbmRcbiAqIGV4cG9zZXMgaXQgdG8gdGhlIHJlc3Qgb2YgdGhlIGFwcGxpY2F0aW9uIGluIGEgQ29udGV4dC5cbiAqL1xuY2xhc3MgU2VhcmNoUHJvdmlkZXIgZXh0ZW5kcyBDb21wb25lbnQge1xuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgIGNoaWxkcmVuOiBQcm9wVHlwZXMubm9kZS5pc1JlcXVpcmVkLFxuICAgIC8vIE5vdCBwcm92aWRpbmcgYSBzaGFwZSBoZXJlIGJlY2F1c2UgdGhlIHNoYXBlIG1hdGNoZXMgdGhlIHNoYXBlIG9mXG4gICAgLy8gU2VhcmNoRHJpdmVyLiBTZWFyY2hEcml2ZXIgY2FuIGRvIGl0J3Mgb3duIHBhcmFtZXRlciB2YWxpZGF0aW9uLlxuICAgIGNvbmZpZzogUHJvcFR5cGVzLm9iamVjdFxuICB9O1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgIGRyaXZlcjogbnVsbFxuICAgIH07XG4gIH1cblxuICBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICBjb25zdCB7IGNvbmZpZyB9ID0gdGhpcy5wcm9wcztcbiAgICAvLyBUaGlzIGluaXRpYWxpemF0aW9uIGlzIGRvbmUgaW5zaWRlIG9mIGNvbXBvbmVudERpZE1vdW50LCBiZWNhdXNlIGluaXRpYWxpemluZyB0aGUgU2VhcmNoRHJpdmVyIHNlcnZlciBzaWRlXG4gICAgLy8gd2lsbCBlcnJvciBvdXQsIHNpbmNlIHRoZSBkcml2ZXIgZGVwZW5kcyBvbiB3aW5kb3cuIFBsYWNpbmcgdGhlIGluaXRpYWxpemF0aW9uIGluc2lkZSBvZiBjb21wb25lbnREaWRNb3VudFxuICAgIC8vIGFzc3VyZXMgdGhhdCBpdCB3b24ndCBhdHRlbXB0IHRvIGluaXRpYWxpemUgc2VydmVyIHNpZGUuXG4gICAgY29uc3QgZHJpdmVyID0gbmV3IFNlYXJjaERyaXZlcih7XG4gICAgICAuLi5jb25maWcsXG4gICAgICBhMTF5Tm90aWZpY2F0aW9uTWVzc2FnZXM6IHtcbiAgICAgICAgLi4uZGVmYXVsdEExMXlNZXNzYWdlcyxcbiAgICAgICAgLi4uY29uZmlnLmExMXlOb3RpZmljYXRpb25NZXNzYWdlc1xuICAgICAgfVxuICAgIH0pO1xuICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgZHJpdmVyXG4gICAgfSk7XG4gIH1cblxuICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcbiAgICB0aGlzLnN0YXRlLmRyaXZlci50ZWFyRG93bigpO1xuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHsgY2hpbGRyZW4gfSA9IHRoaXMucHJvcHM7XG5cbiAgICAvLyBTaW5jZSBkcml2ZXIgaXMgaW5pdGlhbGl6ZWQgaW4gY29tcG9uZW50RGlkTW91bnQgYWJvdmUsIHdlIGFyZSB3YWl0aW5nXG4gICAgLy8gdG8gcmVuZGVyIHVudGlsIHRoZSBkcml2ZXIgaXMgYXZhaWxhYmxlLlxuICAgIGlmICghdGhpcy5zdGF0ZS5kcml2ZXIpIHJldHVybiBudWxsO1xuXG4gICAgLy8gUGFzc2luZyB0aGUgZW50aXJlIFwidGhpcy5zdGF0ZVwiIHRvIHRoZSBDb250ZXh0IGlzIHNpZ25pZmljYW50LiBCZWNhdXNlXG4gICAgLy8gQ29udGV4dCBkZXRlcm1pbmVzIHdoZW4gdG8gcmUtcmVuZGVyIGJhc2VkIG9uIHJlZmVyZW50aWFsIGlkZW50aXR5XG4gICAgLy8gc29tZXRoaW5nIGxpa2UgdGhpcyBjb3VsZCBjYXVzZSB1bm5lY2Vzc2FyeSByZW5kZXJzOlxuICAgIC8vXG4gICAgLy8gPFNlYXJjaENvbnRleHQuUHJvdmlkZXIgdmFsdWU9e3tkcml2ZXI6IHRoaXMuc3RhdGUuZHJpdmVyfX0+XG4gICAgLy9cbiAgICAvLyBCeSBwYXNzaW5nIHRoZSBlbnRpcmUgc3RhdGUsIHdlIGVuc3VyZSB0aGF0IHJlLXJlbmRlcnMgb25seSBvY2N1ciB3aGVuXG4gICAgLy8gc3RhdGUgaXMgYWN0dWFsbHkgdXBkYXRlZC5cbiAgICByZXR1cm4gKFxuICAgICAgPFNlYXJjaENvbnRleHQuUHJvdmlkZXIgdmFsdWU9e3RoaXMuc3RhdGV9PlxuICAgICAgICB7Y2hpbGRyZW59XG4gICAgICA8L1NlYXJjaENvbnRleHQuUHJvdmlkZXI+XG4gICAgKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBTZWFyY2hQcm92aWRlcjtcbiJdfQ==